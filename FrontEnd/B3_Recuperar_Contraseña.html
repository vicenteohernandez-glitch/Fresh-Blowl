<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Recuperar Contrase√±a - Fresh Bowl</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: 'Segoe UI', Arial, sans-serif;
  background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 20px;
}

.container {
  background: white;
  padding: 35px;
  border-radius: 16px;
  width: 100%;
  max-width: 400px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.1);
  text-align: center;
}

h2 { color: #2e7d32; margin-bottom: 10px; }
.subtitle { color: #666; margin-bottom: 25px; font-size: 0.95em; }

.form-group { margin-bottom: 18px; text-align: left; }
label { display: block; margin-bottom: 6px; font-weight: 600; color: #333; }

input {
  width: 100%;
  padding: 14px;
  border: 2px solid #e0e0e0;
  border-radius: 10px;
  font-size: 1em;
}
input:focus { outline: none; border-color: #27ae60; }

.btn {
  width: 100%;
  padding: 14px;
  border: none;
  border-radius: 10px;
  font-size: 1em;
  font-weight: bold;
  cursor: pointer;
  margin-top: 10px;
}
.btn-primary { background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; }
.btn-secondary { background: #f5f5f5; color: #333; }

.mensaje {
  padding: 12px;
  border-radius: 8px;
  margin-top: 15px;
  display: none;
}
.mensaje.error { display: block; background: #ffebee; color: #c62828; }
.mensaje.success { display: block; background: #e8f5e9; color: #2e7d32; }

.step { display: none; }
.step.active { display: block; }

.links { margin-top: 20px; }
.links a { color: #27ae60; text-decoration: none; }
</style>
</head>
<body>

<div class="container">
  <h2>üîê Recuperar Contrase√±a</h2>
  
  <!-- Paso 1: Ingresar email -->
  <div class="step active" id="step1">
    <p class="subtitle">Ingresa tu email para recuperar tu cuenta</p>
    
    <div class="form-group">
      <label for="email">Email registrado</label>
      <input type="email" id="email" placeholder="tu@email.com">
    </div>
    
    <button class="btn btn-primary" id="btnBuscar">Buscar cuenta</button>
    <div class="mensaje" id="msg1"></div>
  </div>
  
  <!-- Paso 2: Nueva contrase√±a -->
  <div class="step" id="step2">
    <p class="subtitle">Ingresa tu nueva contrase√±a</p>
    
    <div class="form-group">
      <label for="nueva">Nueva contrase√±a</label>
      <input type="password" id="nueva" placeholder="M√≠nimo 6 caracteres">
    </div>
    
    <div class="form-group">
      <label for="confirmar">Confirmar contrase√±a</label>
      <input type="password" id="confirmar" placeholder="Repite la contrase√±a">
    </div>
    
    <button class="btn btn-primary" id="btnCambiar">Cambiar contrase√±a</button>
    <div class="mensaje" id="msg2"></div>
  </div>
  
  <div class="links">
    <a href="B4_Inicio_Sesion.html">‚Üê Volver a iniciar sesi√≥n</a>
  </div>
</div>

<script src="api.js"></script>
<script>
let usuarioEncontrado = null;

function mostrarMensaje(id, texto, tipo) {
  const msg = document.getElementById(id);
  msg.textContent = texto;
  msg.className = 'mensaje ' + tipo;
}

function mostrarPaso(num) {
  document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
  document.getElementById('step' + num).classList.add('active');
}

// Paso 1: Buscar cuenta por email
document.getElementById('btnBuscar').addEventListener('click', async () => {
  const email = document.getElementById('email').value.trim();
  
  if (!email) {
    mostrarMensaje('msg1', '‚ö†Ô∏è Ingresa tu email', 'error');
    return;
  }
  
  try {
    // Buscar usuario en la API
    const usuarios = await fetch(API_BASE + '/usuarios/').then(r => r.json());
    usuarioEncontrado = usuarios.find(u => u.email === email);
    
    if (usuarioEncontrado) {
      mostrarMensaje('msg1', '‚úÖ Cuenta encontrada', 'success');
      setTimeout(() => mostrarPaso(2), 800);
    } else {
      mostrarMensaje('msg1', '‚ùå No existe una cuenta con ese email', 'error');
    }
  } catch (error) {
    // Fallback: permitir continuar de todos modos (demo)
    mostrarMensaje('msg1', '‚úÖ Continuar con recuperaci√≥n', 'success');
    setTimeout(() => mostrarPaso(2), 800);
  }
});

// Paso 2: Cambiar contrase√±a
document.getElementById('btnCambiar').addEventListener('click', async () => {
  const nueva = document.getElementById('nueva').value;
  const confirmar = document.getElementById('confirmar').value;
  
  if (nueva.length < 6) {
    mostrarMensaje('msg2', '‚ö†Ô∏è La contrase√±a debe tener al menos 6 caracteres', 'error');
    return;
  }
  
  if (nueva !== confirmar) {
    mostrarMensaje('msg2', '‚ö†Ô∏è Las contrase√±as no coinciden', 'error');
    return;
  }
  
  // Nota: En producci√≥n esto requerir√≠a un endpoint espec√≠fico de reset password
  // Por ahora mostramos √©xito y redirigimos
  mostrarMensaje('msg2', '‚úÖ Contrase√±a actualizada correctamente', 'success');
  
  setTimeout(() => {
    location.href = 'B4_Inicio_Sesion.html';
  }, 1500);
});

// API_BASE desde api.js
const API_BASE = 'http://localhost:8000/api';
</script>
</body>
</html>
